# MySQL基础-记录结构

## 1 InnoDB 记录存储结构

### 1.1 InnoDB 页 

一条条从磁盘读取到内存比较慢，所以使用页，以页作为磁盘与内存交互的基本单位。

### 1.2 InnoDB 行格式

1、有四种行格式：compact、redundant、dynamic、compressed。

### 1.3 compact  格式

变长列表

![](../.gitbook/assets/image%20%28140%29.png)

![](../.gitbook/assets/image%20%28143%29.png)

NULL值列表

```text
1、统计表中允许存储NULL 的列有哪些
2、如果没有允许NULL的列，则NULL值列表也就不存在了。否则允许每个允许存储NULL的列对应
一个二进制位。
3、NULL值列表必须使用整数个字节的位表示，如果不足一字节，则补齐。
```

记录头信息： 由固定的5个字节组成。

![](../.gitbook/assets/image%20%28139%29.png)

![](../.gitbook/assets/image%20%28141%29.png)

记录的真实数据

除了自定义的数据之外，MySQL会为每个记录默认的添加一些列（也成为隐藏列）。

![](../.gitbook/assets/image%20%28144%29.png)

InnoDB主键的生成策略：

```text
优先使用用户自定义主键作为主键，
如果用户没有定义主键，则选取一个Unique键作为主键，
如果表中连Unique键都没有定义的话，则InnoDB会为表默认添加一个名为row_id的隐藏列作为主键。


```

增加了隐藏列之后，行记录是这样的：

![](../.gitbook/assets/image%20%28142%29.png)

**CHAR\(M\)列的存储格式：**

对于 _**CHAR\(M\)**_ 类型的列来说，当列采用的是定长字符集时，该列占用的字节数不会被加到变长字段长度列表，而如果采用变长字符集时，该列占用的字节数也会被加到变长字段长度列表。

### 1.4 行溢出数据-**VARCHAR\(M\)最多能存储的数据**

`VARCHAR(M)`类型的列最多可以占用`65535`个`字节`，其中M代表最多存储的`字符`数量   。

MySQL 对一条记录占用的最大存储空间是有限制的，除了BLOB 或者TEXT 类型的列之外，其他所有列（不包括隐藏列和记录头信息）占用的字节长度加起来不能超过65535个字节。

其实需要占用3部分存储空间：

* 真实数据
* 真实数据占用字节的长度
* `NULL`值标识，如果该列有`NOT NULL`属性则可以没有这部分存储空间

如果该`VARCHAR`类型的列没有`NOT NULL`属性，那最多只能存储`65532`个字节的数据，因为真实数据的长度可能占用2个字节，`NULL`值标识需要占用1个字节。

```text
述所言在列的值允许为NULL的情况下，gbk字符集下M的最大取值就是32766，
utf8字符集下M的最大取值就是21844，这都是在表中只有一个字段的情况下说的，
一定要记住一个行中的所有列（不包括隐藏列和记录头信息）占用的字节长度加起来不能超过65535个字节！
```

疑问：

1、行长度会计算 text 跟 blob 类型的字段吗？？？

2、如果不包含，那text 跟 blob 怎么处理？？？

不只是 _**VARCHAR\(M\)**_ 类型的列，其他的 _**TEXT**_、_**BLOB**_ 类型的列在存储数据非常多的时候也会发生`行溢出`。



### 1.5 行溢出的临界点



## 2 InnoDB 数据页结构



## 3 B+ 树索引



## 4 B+ 树索引的使用



## 5 MySQL的数据目录

## 

## 6 InnoDB的表空间

## 

  

