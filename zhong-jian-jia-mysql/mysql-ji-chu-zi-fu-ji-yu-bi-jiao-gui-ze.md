# MySQL基础-字符集与比较规则

## 0 字符编码基础知识

{% embed url="http://cenalulu.github.io/linux/character-encoding/\#toc0" %}

### 0.1 字符集

字符集只是一个规则集合的名字。

字符编码集：用一个编码值来表示一个字符在字库中规则集合的位置。

字符编码：将编码字符集和实际存储数值之间的转换关系。

### 

## 1 比较规则

比较两个字符的大小。



## 2 字符集

不同的字符集 有不同的编码方式。



## 3 MySQL中支持的字符集和排序规则

在MySQL中一个字符所用最大字节长度在某些方面会影响系统的存储和性能。

### 3.1 utf8 与 utf8mb4

utf8 是 utf8mb3 的缩写，只使用1~3 个字节表示字符。

utf8mb4 正宗的utf8 字符集，使用1~4 个字节表示字符。

### 3.2 字符集对应的最大长度

![](../.gitbook/assets/image%20%28136%29.png)

### 3.3 比较规则

![](../.gitbook/assets/image%20%28137%29.png)

## 4 字符集和比较规则的应用

### 4.1 各级别的字符集和比较规则

* 服务器级别
* 数据库级别
* 表级别
* 列级别

```text
如果创建或修改列时没有显式的指定字符集和比较规则，则该列默认用表的字符集和比较规则
如果创建表时没有显式的指定字符集和比较规则，则该表默认用数据库的字符集和比较规则
如果创建数据库时没有显式的指定字符集和比较规则，则该数据库默认用服务器的字符集和比较规则
```



### 4.2  仅修改字符集或仅修改比较规则

字符集和比较规则是互相有联系的。修改一个，另外一个也跟着变换。

* 只修改字符集，则比较规则将变为修改后的字符集默认的比较规则
* 只修改比较规则，则字符集将变为修改后的比较规则对应的字符集。

## 5 客户端和服务器通信中的字符集

### 5.1 MySQL字符集转换

![](../.gitbook/assets/image%20%28138%29.png)

从请求发出，到结果返回经历的几个阶段：

1、客户端发送请求使用的字符集

```text
一般情况下客户端所使用的字符集和当前操作系统一致，不同操作系统使用的字符集可能不一样，如下：

类Unix系统使用的是utf8
Windows使用的是gbk
```

2、服务端接收客户端的请求，它会认为这串字节采用的字符集是`character_set_client`，然后把这串字节转换为`character_set_connection`字符集编码的字符。

3、服务端处理 使用 character\_set\_connection 

4、结果返回时，使用character\_set\_results。

5、客户端使用自己系统的字符集，转换结果。

![](../.gitbook/assets/image%20%28134%29.png)

## 6 比较规则的应用



`比较规则`的作用通常体现比较字符串大小的表达式以及对某个字符串列进行排序中，所以有时候也称为`排序规则`

