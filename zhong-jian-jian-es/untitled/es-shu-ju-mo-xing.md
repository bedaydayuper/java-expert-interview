# ES 数据模型

## 1 数据副本策略

![&#x6570;&#x636E;&#x526F;&#x672C;&#x7B56;&#x7565;](../../.gitbook/assets/image%20%2812%29.png)

## 2 ES 数据副本模型

### 2.1 基本写入模型

![](../../.gitbook/assets/image%20%2822%29.png)

### 2.2 基本读取模型

![](../../.gitbook/assets/image%20%2815%29.png)

## 3 Allocation Id

用于主节点决定哪个分片应该分配到哪个节点，以及哪个分片作为主分片。

主节点会维护一个最新shard 的Application id 集合，这个集合维护了最新的数据，只有在这个集合中的分片，才有资格被选为主分片。

## 4 Sequence Num

Primary Terms: 由主节点分配给每个主分片，每次主分片发生变化时递增；

Sequence Numbers 标记某个分片上的写操作。由主分片分配，只对写操作分配。

全局检查点：所有活跃分片历史都已对齐的序列号。所有低于全局检查点的操作都保证已经被活跃分片处理完毕。

本地检查点：每个分片自己本地的检查点序列号。所有序列号低于检查点的操作都已在该分片上处理。



本地以及全局检查点主要是用于数据恢复。

## 5 \_version

每个文档都有一个版本号，当文档被修改时版本号递增。确保变更以正确顺序执行。

版本号由主分片生成，在将请求转发给副本时将携带此版本号。

